# Task: Rich Text Editor Implementation (TDD)

- [x] Install dependencies (`@tiptap/extension-underline`) <!-- id: 0 -->
- [x] **RichTextEditor Component (TDD)** <!-- id: 1 -->
    - [x] ğŸ”´ RED: Create `components/RichTextEditor.test.tsx` (Fulfills Toolbar & A4 requirements) <!-- id: 2 -->
    - [x] ğŸŸ¢ GREEN: Create `components/RichTextEditor.tsx` (Implement TipTap, Toolbar, Styles) <!-- id: 3 -->
    - [ ] ğŸ”µ REFACTOR: Optimize component <!-- id: 4 -->
- [x] **Integration & Refactor** <!-- id: 5 -->
    - [x] Refactor `LegislativeEditor.tsx` to use `RichTextEditor` <!-- id: 6 -->
    - [x] Update `Legislative.tsx` to support editing existing documents <!-- id: 7 -->
    - [x] Ensure "Save" writes HTML and Plain Text (for search) <!-- id: 8 -->
- [ ] **Verification** <!-- id: 9 -->
    - [ ] Verify "New Document" flow with Templates <!-- id: 10 -->
    - [ ] Verify "Edit Document" flow <!-- id: 11 -->
- [x] **Refactor Critic** <!-- id: 12 -->
    - [x] ğŸ¨ CSS Fix: Add list styles to RichTextEditor <!-- id: 13 -->
    - [x] ğŸ”„ Navigation: Refactor handleEdit/handleView in Legislative <!-- id: 14 -->
    - [x] ğŸ·ï¸ Types: Implement OFFICIAL_TYPES constant <!-- id: 15 -->
- [x] **Visual Identity (Vertical Slice)** <!-- id: 17 -->
    - [x] ğŸ—„ï¸ DB: Add columns to `cabinets` <!-- id: 18 -->
    - [x] âš™ï¸ Settings: Add 'Identidade Visual' tab & Upload <!-- id: 19 -->
    - [x] ğŸ“ Editor: Apply A4 branding (Header/Footer) <!-- id: 20 -->
- [x] **Export to Word (.docx)** <!-- id: 21 -->
    - [x] ğŸ“¦ Install dependencies (`html-docx-js-typescript`, `file-saver`) <!-- id: 22 -->
    - [x] ğŸ§© Implement Export Logic in `RichTextEditor` <!-- id: 23 -->
- [ ] **Native RAG (Copilot)** <!-- id: 24 -->
    - [x] ğŸ—„ï¸ DB: `document_chunks` table + `match_documents` RPC <!-- id: 25 -->
    - [x] ğŸ¤– Backend: `query-copilot` Edge Function (Gemini + Supabase) <!-- id: 26 -->
    - [x] ğŸ”Œ Frontend: `CopilotWidget` Integration (Streaming) <!-- id: 27 -->
    - [x] ğŸ”€ Hybrid Mode: Added OpenAI Support (DB/API/Settings) <!-- id: 29 -->
    - [x] ğŸ•µï¸ **Data Agent**: Implement `voters` SQL Tool (`query_voters_smart`) <!-- id: 31 -->
    - [ ] ğŸ§ª Verification: Test Chat Flow + Data Query <!-- id: 28 -->
- [ ] **Copilot Refinement (Feedback)** <!-- id: 32 -->
    - [ ] ğŸ”´ FIX: Add `type` filtering to `query_database` (IndicaÃ§Ãµes/MoÃ§Ãµes) <!-- id: 33 -->
    - [ ] ğŸ”´ FIX: Include File Metadata/Description in RAG Context <!-- id: 34 -->
